<p style="text-align: center;"><span style="color: #00ff00;">CRASH</span></p>
<p style="text-align: center;">&nbsp;</p>
<p><span style="color: #00ff00;"><em><strong>#include "libssh/priv.h"</strong></em></span><br /><span style="color: #00ff00;"><em><strong>#include "libssh/libssh.h"</strong></em></span><br /><span style="color: #00ff00;"><em><strong>#include "libssh/token.h"</strong></em></span></p>
<p><span style="color: #00ff00;"><em><strong>#define set_status(session, status) do {\</strong></em></span><br /><span style="color: #00ff00;"><em><strong>if (session-&gt;common.callbacks &amp;&amp; session-&gt;common.callbacks-&gt;connect_status_function) \</strong></em></span><br /><span style="color: #00ff00;"><em><strong>session-&gt;common.callbacks-&gt;connect_status_function(session-&gt;common.callbacks-&gt;userdata, status); \</strong></em></span><br /><span style="color: #00ff00;"><em><strong>} while (0)</strong></em></span></p>
<p><span style="color: #00ff00;"><em><strong>/**</strong></em></span><br /><span style="color: #00ff00;"><em><strong>* @addtogroup libssh_server</strong></em></span><br /><span style="color: #00ff00;"><em><strong>*</strong></em></span><br /><span style="color: #00ff00;"><em><strong>* @{</strong></em></span><br /><span style="color: #00ff00;"><em><strong>",rsa-sha2-512,rsa-sha2-256");</strong></em></span></p>
<p><span style="color: #00ff00;"><em><strong>len = strlen(hostkeys);</strong></em></span><br /><span style="color: #00ff00;"><em><strong>keytype = ssh_key_type(session-&gt;srv.rsa_key);</strong></em></span></p>
<p><span style="color: #00ff00;"><em><strong>snprintf(hostkeys + len, sizeof(hostkeys) - len,</strong></em></span><br /><span style="color: #00ff00;"><em><strong>",%s", ssh_key_type_to_char(keytype));</strong></em></span><br /><span style="color: #00ff00;"><em><strong>}</strong></em></span></p>
<p><span style="color: #00ff00;"><em><strong>if (strlen(hostkeys) == 0) {</strong></em></span><br /><span style="color: #00ff00;"><em><strong>return -1;</strong></em></span><br /><span style="color: #00ff00;"><em><strong>}</strong></em></span></p>
<p><span style="color: #00ff00;"><em><strong>if (session-&gt;opts.wanted_methods[SSH_HOSTKEYS]) {</strong></em></span><br /><span style="color: #00ff00;"><em><strong>allowed = session-&gt;opts.wanted_methods[SSH_HOSTKEYS];</strong></em></span><br /><span style="color: #00ff00;"><em><strong>} else {</strong></em></span><br /><span style="color: #00ff00;"><em><strong>if (ssh_fips_mode()) {</strong></em></span><br /><span style="color: #00ff00;"><em><strong>allowed = ssh_kex_get_fips_methods(SSH_HOSTKEYS);</strong></em></span><br /><span style="color: #00ff00;"><em><strong>} else {</strong></em></span><br /><span style="color: #00ff00;"><em><strong>allowed = ssh_kex_get_default_methods(SSH_HOSTKEYS);</strong></em></span><br /><span style="color: #00ff00;"><em><strong>}</strong></em></span><br /><span style="color: #00ff00;"><em><strong>}</strong></em></span></p>
<p><span style="color: #00ff00;"><em><strong>/* It is expected for the list of allowed hostkeys to be ordered by</strong></em></span><br /><span style="color: #00ff00;"><em><strong>* preference */</strong></em></span><br /><span style="color: #00ff00;"><em><strong>kept = ssh_find_all_matching(hostkeys[0] == ',' ? hostkeys + 1 : hostkeys,</strong></em></span><br /><span style="color: #00ff00;"><em><strong>allowed);</strong></em></span><br /><span style="color: #00ff00;"><em><strong>if (kept == NULL) {</strong></em></span><br /><span style="color: #00ff00;"><em><strong>/* Nothing was allowed */</strong></em></span><br /><span style="color: #00ff00;"><em><strong>return -1;</strong></em></span><br /><span style="color: #00ff00;"><em><strong>}</strong></em></span></p>
<p><br /><span style="color: #00ff00;"><em><strong>return -1;</strong></em></span><br /><span style="color: #00ff00;"><em><strong>}</strong></em></span><br /><span style="color: #00ff00;"><em><strong>}</strong></em></span></p>
<p><span style="color: #00ff00;"><em><strong>return 0;</strong></em></span><br /><span style="color: #00ff00;"><em><strong>}</strong></em></span></p>